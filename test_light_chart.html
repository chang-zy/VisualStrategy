<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Price Chart with Buy/Sell Markers</title>
    <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
</head>
<body>
    <div id="chart" style="width: 100%; height: 500px;"></div>

    <script>
        // Prepare price data from Flask backend
        const priceData = {{ price_data|tojson }};
        const orderData = {{ order_data|tojson }};

        // Convert price data into format required by lightweight-charts
        const priceSeriesData = priceData.map(item => ({
            time: item.Date,
            value: parseFloat(item.Close)  // Assuming 'Close' is the price column to plot
        }));

        // Create the chart
        const chart = LightweightCharts.createChart(document.getElementById('chart'), {
            width: 800,
            height: 500,
        });

        // Add a line series for stock prices
        const priceSeries = chart.addLineSeries();
        priceSeries.setData(priceSeriesData);

        // Adding markers for buy/sell orders
        const markers = orderData.map(order => ({
            time: order.Date,  // The date of the order
            position: 'aboveBar',  // Place the marker above the bar
            color: order['Order Type'] === 'BUY' ? 'green' : 'red',  // Green for 'BUY', Red for 'SELL'
            shape: order['Order Type'] === 'BUY' ? 'arrowUp' : 'arrowDown',  // Arrow up for 'BUY', Arrow down for 'SELL'
            text: `${order['Order Type']} at ${parseFloat(order.Price).toFixed(2)}`  // Display the order type and price
        }));

        // Apply the markers on the price series
        priceSeries.setMarkers(markers);

        // Make the chart responsive
        window.addEventListener('resize', () => {
            chart.applyOptions({ width: document.getElementById('chart').clientWidth });
        });
    </script>
</body>
</html>